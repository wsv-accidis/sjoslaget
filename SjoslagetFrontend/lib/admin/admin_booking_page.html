<h1>
	Redigera bokning {{ null != booking ? booking.reference : '' }}
</h1>

<div class="admin-menu">
	<glyph icon="arrow_back"></glyph>
	<a [routerLink]="['Dashboard']">Huvudsidan</a>
	<span></span>
	<glyph icon="view_list"></glyph>
	<a [routerLink]="['BookingList']">Alla bokningar</a>
</div>

<p>
	Här redigerar du bokningen och registrerar när betalningar har kommit in. Tänk på att kontaktpersonen också kan
	redigera bokningen efter att den skapats, men du kan låsa en bokning för att hindra flera ändringar.
</p>

<div style="clear: both; height: 10px;"></div>

<form #bookingForm="ngForm">
	<cabins-component #cabins></cabins-component>

	<h2 style="margin-top: 30px; margin-bottom: 5px">Kontaktperson</h2>

	<div *ngIf="hasLoaded" style="margin-left: 5px">
		<material-input [(ngModel)]="booking.firstName"
						ngControl="firstName"
						floatingLabel
						label="Förnamn"
						required
						requiredErrorMsg="Ange förnamn."
						style="width: 150px; margin-right: 20px">
		</material-input>

		<material-input [(ngModel)]="booking.lastName"
						ngControl="lastName"
						floatingLabel
						label="Efternamn"
						required
						requiredErrorMsg="Ange efternamn."
						style="width: 150px; margin-right: 20px">
		</material-input>
		<material-input [(ngModel)]="booking.phoneNo"
						ngControl="phoneNo"
						floatingLabel
						label="Telefonnummer"
						required
						requiredErrorMsg="Ange telefonnummer."
						pattern="[0-9()+\- ]+"
						style="width: 150px; margin-right: 20px"
						type="tel">
		</material-input>

		<material-input [(ngModel)]="booking.email"
						ngControl="email"
						floatingLabel
						label="E-postadress"
						required
						requiredErrorMsg="Ange e-postadress."
						pattern="[_a-zA-Z0-9-]+(\.[_a-zA-Z0-9-]+)*@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.([a-zA-Z]{2,6})"
						style="width: 250px; margin-right: 20px"
						tel="email">
		</material-input>

		<div class="booking-lunch">
			<span>
				Önskad sittning
			</span>

			<material-radio-group [(ngModel)]="booking.lunch"
								  ngControl="lunch">
				<material-radio style="margin-left: 0"
								value="11">
					11:00
				</material-radio>
				<material-radio [checked]="true"
								value="13">
					13:00
				</material-radio>
				<material-radio value="15">
					15:00
				</material-radio>
			</material-radio-group>
		</div>
	</div>

	<spinner-widget *ngIf="!hasLoaded"></spinner-widget>

	<div>
		<material-button class="control-blue"
						 [disabled]="!canSaveCabins || !bookingForm.valid"
						 raised
						 (trigger)="saveBooking()">
			Spara bokningen
		</material-button>

		<material-button *ngIf="canLock"
						 class="control-red"
						 [disabled]="isLockingUnlocking"
						 raised
						 (trigger)="lockUnlockBooking()">
			Lås bokningen
		</material-button>

		<material-button *ngIf="canUnlock"
						 class="control-green"
						 [disabled]="isLockingUnlocking"
						 raised
						 (trigger)="lockUnlockBooking()">
			Lås upp bokningen
		</material-button>

		<material-button class="control-red"
						 [disabled]="!canDelete"
						 raised
						 (trigger)="deleteBooking()">
			Radera bokningen
		</material-button>
	</div>

	<spinner-widget *ngIf="isSaving"></spinner-widget>

	<p class="super-important" *ngIf="hasBookingError">
		{{ bookingError }}
	</p>
</form>

<h2 style="margin-top: 30px">
	Betalningar
</h2>

<p class="booking-payments">
	Här registrerar du inkomna betalningar för den här bokningen. Korrigeringar och återbetalningar kan göras genom att
	ange negativa belopp. Du kan också rabattera bokningen (rabatten är inte kumulativ).
</p>

<p class="booking-payments" *ngIf="!cabins.hasPayment">
	Bokningens totala pris är <span>{{ cabins.priceWithDiscountFormatted }}</span>.
</p>

<p class="booking-payments" *ngIf="cabins.hasPayment">
	Bokningens pris är <span>{{ cabins.priceWithDiscountFormatted }}</span> och totalt <span>{{ cabins.amountPaidFormatted }}</span> har betalats in.
	Det återstår att betala <span>{{ cabins.priceRemainingFormatted }}</span>. Den senaste betalningen registrerades <span>{{ latestPaymentFormatted }}</span>.
</p>

<form #paymentForm="ngForm">
	<div class="booking-payments-form">
		Betalning

		<material-input [(ngModel)]="payment"
						ngControl="payment"
						class="payment-field"
						floatingLabel
						label="Belopp"
						required
						requiredErrorMsg="Ange belopp."
						pattern="[0-9\-,\.]+"
						type="number">
		</material-input>

		kr

		<material-button class="control-blue payment-button"
						 [disabled]="!paymentForm.valid || isSaving"
						 raised
						 (trigger)="registerPayment()">
			Registrera betalning
		</material-button>

		<span>
			Rabatt
		</span>

		<material-input [(ngModel)]="discount"
						ngControl="discount"
						class="payment-field"
						floatingLabel
						label="Rabatt"
						required
						requiredErrorMsg="Ange procentsats."
						pattern="[0-9%]+"
						type="number">
		</material-input>

		%

		<material-button class="control-blue payment-button"
						 [disabled]="!paymentForm.valid || isSaving"
						 raised
						 (trigger)="updateDiscount()">
			Uppdatera rabatt
		</material-button>
	</div>

	<p class="super-important" *ngIf="hasPaymentError">
		{{ paymentError }}
	</p>
</form>

<modal-dialog #deleteBookingDialog
			  action="Ja, radera"
			  title="Radera bokning"
			  message="Är du säker? Bokningen raderas permanent. Det här går inte att ångra.">
</modal-dialog>
